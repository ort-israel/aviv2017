!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.adapter=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d={};d.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},d.localCName=d.generateIdentifier(),d.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},d.splitSections=function(a){var b=a.split("\nm=");return b.map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},d.matchPrefix=function(a,b){return d.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},d.parseCandidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],port:parseInt(b[5],10),type:b[7]},d=8;d<b.length;d+=2)switch(b[d]){case"raddr":c.relatedAddress=b[d+1];break;case"rport":c.relatedPort=parseInt(b[d+1],10);break;case"tcptype":c.tcpType=b[d+1]}return c},d.writeCandidate=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),"candidate:"+b.join(" ")},d.parseRtpMap=function(a){var b=a.substr(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return b=b[0].split("/"),c.name=b[0],c.clockRate=parseInt(b[1],10),c.numChannels=3===b.length?parseInt(b[2],10):1,c},d.writeRtpMap=function(a){var b=a.payloadType;return void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType),"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"},d.parseExtmap=function(a){var b=a.substr(9).split(" ");return{id:parseInt(b[0],10),uri:b[1]}},d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+" "+a.uri+"\r\n"},d.parseFmtp=function(a){for(var b,c={},d=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<d.length;e++)b=d[e].trim().split("="),c[b[0].trim()]=b[1];return c},d.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){d.push(b+"="+a.parameters[b])}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},d.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},d.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},d.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},d.getMid=function(a){var b=d.matchPrefix(a,"a=mid:")[0];if(b)return b.substr(6)},d.getDtlsParameters=function(a,b){var c=d.splitLines(a);c=c.concat(d.splitLines(b));var e=c.filter(function(a){return 0===a.indexOf("a=fingerprint:")})[0].substr(14),f={role:"auto",fingerprints:[{algorithm:e.split(" ")[0].toLowerCase(),value:e.split(" ")[1]}]};return f},d.writeDtlsParameters=function(a,b){var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},d.getIceParameters=function(a,b){var c=d.splitLines(a);c=c.concat(d.splitLines(b));var e={usernameFragment:c.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:c.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)};return e},d.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"},d.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(a),e=c[0].split(" "),f=3;f<e.length;f++){var g=e[f],h=d.matchPrefix(a,"a=rtpmap:"+g+" ")[0];if(h){var i=d.parseRtpMap(h),j=d.matchPrefix(a,"a=fmtp:"+g+" ");switch(i.parameters=j.length?d.parseFmtp(j[0]):{},i.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+g+" ").map(d.parseRtcpFb),b.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":b.fecMechanisms.push(i.name.toUpperCase())}}}return d.matchPrefix(a,"a=extmap:").forEach(function(a){b.headerExtensions.push(d.parseExtmap(a))}),b},d.writeRtpDescription=function(a,b){var c="";c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" UDP/TLS/RTP/SAVPF ",c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(function(a){c+=d.writeRtpMap(a),c+=d.writeFmtp(a),c+=d.writeRtcpFb(a)});var e=0;return b.codecs.forEach(function(a){a.maxptime>e&&(e=a.maxptime)}),e>0&&(c+="a=maxptime:"+e+"\r\n"),c+="a=rtcp-mux\r\n",b.headerExtensions.forEach(function(a){c+=d.writeExtmap(a)}),c},d.parseRtpEncodingParameters=function(a){var b,c=[],e=d.parseRtpParameters(a),f=e.fecMechanisms.indexOf("RED")!==-1,g=e.fecMechanisms.indexOf("ULPFEC")!==-1,h=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),i=h.length>0&&h[0].ssrc,j=d.matchPrefix(a,"a=ssrc-group:FID").map(function(a){var b=a.split(" ");return b.shift(),b.map(function(a){return parseInt(a,10)})});j.length>0&&j[0].length>1&&j[0][0]===i&&(b=j[0][1]),e.codecs.forEach(function(a){if("RTX"===a.name.toUpperCase()&&a.parameters.apt){var d={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{ssrc:b}};c.push(d),f&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:b,mechanism:g?"red+ulpfec":"red"},c.push(d))}}),0===c.length&&i&&c.push({ssrc:i});var k=d.matchPrefix(a,"b=");return k.length&&(0===k[0].indexOf("b=TIAS:")?k=parseInt(k[0].substr(7),10):0===k[0].indexOf("b=AS:")&&(k=parseInt(k[0].substr(5),10)),c.forEach(function(a){a.maxBitrate=k})),c},d.parseRtcpParameters=function(a){var b={},c=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];c&&(b.cname=c.value,b.ssrc=c.ssrc);var e=d.matchPrefix(a,"a=rtcp-rsize");b.reducedSize=e.length>0,b.compound=0===e.length;var f=d.matchPrefix(a,"a=rtcp-mux");return b.mux=f.length>0,b},d.parseMsid=function(a){var b,c=d.matchPrefix(a,"a=msid:");if(1===c.length)return b=c[0].substr(7).split(" "),{stream:b[0],track:b[1]};var e=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});return e.length>0?(b=e[0].value.split(" "),{stream:b[0],track:b[1]}):void 0},d.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(a,b,c,e){var f=d.writeRtpDescription(a.kind,b);if(f+=d.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active"),f+="a=mid:"+a.mid+"\r\n",f+=a.rtpSender&&a.rtpReceiver?"a=sendrecv\r\n":a.rtpSender?"a=sendonly\r\n":a.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",a.rtpSender){var g="msid:"+e.id+" "+a.rtpSender.track.id+"\r\n";f+="a="+g,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+g,a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+g,f+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),f},d.getDirection=function(a,b){for(var c=d.splitLines(a),e=0;e<c.length;e++)switch(c[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[e].substr(2)}return b?d.getDirection(b):"sendrecv"},d.getKind=function(a){var b=d.splitLines(a),c=b[0].split(" ");return c[0].substr(2)},d.isRejected=function(a){return"0"===a.split(" ",2)[1]},b.exports=d},{}],2:[function(a,b,c){"use strict";!function(){var c=a("./utils"),d=c.log,e=c.browserDetails;b.exports.browserDetails=e,b.exports.extractVersion=c.extractVersion,b.exports.disableLog=c.disableLog;var f=a("./chrome/chrome_shim")||null,g=a("./edge/edge_shim")||null,h=a("./firefox/firefox_shim")||null,i=a("./safari/safari_shim")||null;switch(e.browser){case"chrome":if(!f||!f.shimPeerConnection)return void d("Chrome shim is not included in this adapter release.");d("adapter.js shimming chrome."),b.exports.browserShim=f,f.shimGetUserMedia(),f.shimMediaStream(),c.shimCreateObjectURL(),f.shimSourceObject(),f.shimPeerConnection(),f.shimOnTrack(),f.shimGetSendersWithDtmf();break;case"firefox":if(!h||!h.shimPeerConnection)return void d("Firefox shim is not included in this adapter release.");d("adapter.js shimming firefox."),b.exports.browserShim=h,h.shimGetUserMedia(),c.shimCreateObjectURL(),h.shimSourceObject(),h.shimPeerConnection(),h.shimOnTrack();break;case"edge":if(!g||!g.shimPeerConnection)return void d("MS edge shim is not included in this adapter release.");d("adapter.js shimming edge."),b.exports.browserShim=g,g.shimGetUserMedia(),c.shimCreateObjectURL(),g.shimPeerConnection(),g.shimReplaceTrack();break;case"safari":if(!i)return void d("Safari shim is not included in this adapter release.");d("adapter.js shimming safari."),b.exports.browserShim=i,i.shimOnAddStream(),i.shimGetUserMedia();break;default:d("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":8,"./safari/safari_shim":10,"./utils":11}],3:[function(a,b,c){"use strict";var d=a("../utils.js").log,e=a("../utils.js").browserDetails,f={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){var b=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.addEventListener("addtrack",function(c){var d=new Event("track");d.track=c.track,d.receiver={track:c.track},d.streams=[a.stream],b.dispatchEvent(d)}),a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}})},shimGetSendersWithDtmf:function(){if("object"==typeof window&&window.RTCPeerConnection&&!("getSenders"in RTCPeerConnection.prototype)&&"createDTMFSender"in RTCPeerConnection.prototype){RTCPeerConnection.prototype.getSenders=function(){return this._senders};var a=RTCPeerConnection.prototype.addStream,b=RTCPeerConnection.prototype.removeStream;RTCPeerConnection.prototype.addStream=function(b){var c=this;c._senders=c._senders||[],a.apply(c,[b]),b.getTracks().forEach(function(a){c._senders.push({track:a,get dtmf(){return void 0===this._dtmf&&("audio"===a.kind?this._dtmf=c.createDTMFSender(a):this._dtmf=null),this._dtmf}})})},RTCPeerConnection.prototype.removeStream=function(a){var c=this;c._senders=c._senders||[],b.apply(c,[a]),a.getTracks().forEach(function(a){var b=c._senders.find(function(b){return b.track===a});b&&c._senders.splice(c._senders.indexOf(b),1)})}}},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var b=this;return this._srcObject=a,this.src&&URL.revokeObjectURL(this.src),a?(this.src=URL.createObjectURL(a),a.addEventListener("addtrack",function(){b.src&&URL.revokeObjectURL(b.src),b.src=URL.createObjectURL(a)}),void a.addEventListener("removetrack",function(){b.src&&URL.revokeObjectURL(b.src),b.src=URL.createObjectURL(a)})):void(this.src="")}}))},shimPeerConnection:function(){if(window.RTCPeerConnection){var a=RTCPeerConnection;window.RTCPeerConnection=function(b,c){if(b&&b.iceServers){for(var d=[],e=0;e<b.iceServers.length;e++){var f=b.iceServers[e];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(console.warn("RTCIceServer.url is deprecated! Use urls instead."),f=JSON.parse(JSON.stringify(f)),f.urls=f.url,d.push(f)):d.push(b.iceServers[e])}b.iceServers=d}return new a(b,c)},window.RTCPeerConnection.prototype=a.prototype,Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return a.generateCertificate}})}else window.RTCPeerConnection=function(a,b){return d("PeerConnection"),a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy),new webkitRTCPeerConnection(a,b)},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}});var b=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(a,c,d){var e=this,f=arguments;if(arguments.length>0&&"function"==typeof a)return b.apply(this,arguments);if(0===b.length&&(0===arguments.length||"function"!=typeof arguments[0]))return b.apply(this,[]);var g=function(a){var b={},c=a.result();return c.forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b},h=function(a){return new Map(Object.keys(a).map(function(b){return[b,a[b]]}))};if(arguments.length>=2){var i=function(a){f[1](h(g(a)))};return b.apply(this,[i,arguments[0]])}return new Promise(function(a,c){b.apply(e,[function(b){a(h(g(b)))},c])}).then(c,d)},e.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=RTCPeerConnection.prototype[a];RTCPeerConnection.prototype[a]=function(){var a=arguments,c=this,d=new Promise(function(d,e){b.apply(c,[a[0],d,e])});return a.length<2?d:d.then(function(){a[1].apply(null,[])},function(b){a.length>=3&&a[2].apply(null,[b])})}}),e.version<52&&["createOffer","createAnswer"].forEach(function(a){var b=RTCPeerConnection.prototype[a];RTCPeerConnection.prototype[a]=function(){var a=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var c=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){b.apply(a,[d,e,c])})}return b.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=RTCPeerConnection.prototype[a];RTCPeerConnection.prototype[a]=function(){return arguments[0]=new("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(arguments[0]),b.apply(this,arguments)}});var c=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};b.exports={shimMediaStream:f.shimMediaStream,shimOnTrack:f.shimOnTrack,shimGetSendersWithDtmf:f.shimGetSendersWithDtmf,shimSourceObject:f.shimSourceObject,shimPeerConnection:f.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils.js":11,"./getusermedia":4}],4:[function(a,b,c){"use strict";var d=a("../utils.js").log,e=a("../utils.js").browserDetails;b.exports=function(){var a=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),f={},f[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},b=function(b,c){if(b=JSON.parse(JSON.stringify(b)),b&&b.audio&&(b.audio=a(b.audio)),b&&"object"==typeof b.video){var f=b.video.facingMode;f=f&&("object"==typeof f?f:{ideal:f});var g=e.version<61;if(f&&("user"===f.exact||"environment"===f.exact||"user"===f.ideal||"environment"===f.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||g)){delete b.video.facingMode;var h;if("environment"===f.exact||"environment"===f.ideal?h=["back","rear"]:"user"!==f.exact&&"user"!==f.ideal||(h=["front"]),h)return navigator.mediaDevices.enumerateDevices().then(function(e){e=e.filter(function(a){return"videoinput"===a.kind});var g=e.find(function(a){return h.some(function(b){return a.label.toLowerCase().indexOf(b)!==-1})});return!g&&e.length&&h.indexOf("back")!==-1&&(g=e[e.length-1]),g&&(b.video.deviceId=f.exact?{exact:g.deviceId}:{ideal:g.deviceId}),b.video=a(b.video),d("chrome: "+JSON.stringify(b)),c(b)})}b.video=a(b.video)}return d("chrome: "+JSON.stringify(b)),c(b)},c=function(a){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},f=function(a,d,e){b(a,function(a){navigator.webkitGetUserMedia(a,d,function(a){e(c(a))})})};navigator.getUserMedia=f;var g=function(a){return new Promise(function(b,c){navigator.getUserMedia(a,b,c)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:g,enumerateDevices:function(){return new Promise(function(a){var b={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,kind:b[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),navigator.mediaDevices.getUserMedia){var h=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(a){return b(a,function(a){return h(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return b},function(a){return Promise.reject(c(a))})})}}else navigator.mediaDevices.getUserMedia=function(a){return g(a)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){d("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){d("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":11}],5:[function(a,b,c){"use strict";var d=a("../utils").browserDetails,e=a("./rtcpeerconnection_shim");b.exports={shimGetUserMedia:a("./getusermedia"),shimPeerConnection:function(){if(window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(a){return a}),window.RTCSessionDescription||(window.RTCSessionDescription=function(a){return a}),d.version<15025)){var a=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(b){a.set.call(this,b);var c=new Event("enabled");c.enabled=b,this.dispatchEvent(c)}})}window.RTCPeerConnection=e(d.version)},shimReplaceTrack:function(){!window.RTCRtpSender||"replaceTrack"in RTCRtpSender.prototype||(RTCRtpSender.prototype.replaceTrack=RTCRtpSender.prototype.setTrack)}}},{"../utils":11,"./getusermedia":6,"./rtcpeerconnection_shim":7}],6:[function(a,b,c){"use strict";b.exports=function(){var a=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},b=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return b(c)["catch"](function(b){return Promise.reject(a(b))})}}},{}],7:[function(a,b,c){"use strict";function d(a){var b=a.filter(function(a){return"audio"===a.kind}),c=a.filter(function(a){return"video"===a.kind});for(a=[];b.length||c.length;)b.length&&a.push(b.shift()),c.length&&a.push(c.shift());return a}function e(a,b){var c=!1;return a=JSON.parse(JSON.stringify(a)),a.filter(function(a){if(a&&(a.urls||a.url)){var d=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var e="string"==typeof d;return e&&(d=[d]),d=d.filter(function(a){var d=0===a.indexOf("turn:")&&a.indexOf("transport=udp")!==-1&&a.indexOf("turn:[")===-1&&!c;return d?(c=!0,!0):0===a.indexOf("stun:")&&b>=14393}),delete a.url,a.urls=e?d[0]:d,!!d.length}return!1})}var f=a("sdp");b.exports=function(a){var b=function(b){var c=this,d=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){c[a]=d[a].bind(d)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return c.localStreams},this.getRemoteStreams=function(){return c.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},b&&b.iceTransportPolicy)switch(b.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=b.iceTransportPolicy}this.usingBundle=b&&"max-bundle"===b.bundlePolicy,b&&b.iceServers&&(this.iceOptions.iceServers=e(b.iceServers,a)),this._config=b||{},this.transceivers=[],this._localIceCandidatesBuffer=[]};return b.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this.dispatchEvent(a),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(a)},b.prototype._emitBufferedCandidates=function(){var a=this,b=f.splitSections(a.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(c){var d=!c.candidate||0===Object.keys(c.candidate).length;if(d)for(var e=1;e<b.length;e++)b[e].indexOf("\r\na=end-of-candidates\r\n")===-1&&(b[e]+="a=end-of-candidates\r\n");else b[c.candidate.sdpMLineIndex+1]+="a="+c.candidate.candidate+"\r\n";if(a.localDescription.sdp=b.join(""),a.dispatchEvent(c),null!==a.onicecandidate&&a.onicecandidate(c),!c.candidate&&"complete"!==a.iceGatheringState){var f=a.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});f&&"complete"!==a.iceGatheringStateChange&&(a.iceGatheringState="complete",a._emitGatheringStateChange())}}),this._localIceCandidatesBuffer=[]},b.prototype.getConfiguration=function(){return this._config},b.prototype.addStream=function(b){if(a>=15025)this.localStreams.push(b);else{var c=b.clone();b.getTracks().forEach(function(a,b){var d=c.getTracks()[b];a.addEventListener("enabled",function(a){d.enabled=a.enabled})}),this.localStreams.push(c)}this._maybeFireNegotiationNeeded()},b.prototype.removeStream=function(a){var b=this.localStreams.indexOf(a);b>-1&&(this.localStreams.splice(b,1),this._maybeFireNegotiationNeeded())},b.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},b.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},b.prototype._getCommonCapabilities=function(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]},d=function(a,b){a=parseInt(a,10);for(var c=0;c<b.length;c++)if(b[c].payloadType===a||b[c].preferredPayloadType===a)return b[c]},e=function(a,b,c,e){var f=d(a.parameters.apt,c),g=d(b.parameters.apt,e);return f&&g&&f.name.toLowerCase()===g.name.toLowerCase()};return a.codecs.forEach(function(d){for(var f=0;f<b.codecs.length;f++){var g=b.codecs[f];if(d.name.toLowerCase()===g.name.toLowerCase()&&d.clockRate===g.clockRate){if("rtx"===d.name.toLowerCase()&&d.parameters&&g.parameters.apt&&!e(d,g,a.codecs,b.codecs))continue;g=JSON.parse(JSON.stringify(g)),g.numChannels=Math.min(d.numChannels,g.numChannels),c.codecs.push(g),g.rtcpFeedback=g.rtcpFeedback.filter(function(a){for(var b=0;b<d.rtcpFeedback.length;b++)if(d.rtcpFeedback[b].type===a.type&&d.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c},b.prototype._createIceAndDtlsTransports=function(a,b){var c=this,d=new RTCIceGatherer(c.iceOptions),e=new RTCIceTransport(d);d.onlocalcandidate=function(g){var h=new Event("icecandidate");h.candidate={sdpMid:a,sdpMLineIndex:b};var i=g.candidate,j=!i||0===Object.keys(i).length;j?void 0===d.state&&(d.state="completed"):(i.component="RTCP"===e.component?2:1,h.candidate.candidate=f.writeCandidate(i));var k=f.splitSections(c.localDescription.sdp);j?k[h.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n":k[h.candidate.sdpMLineIndex+1]+="a="+h.candidate.candidate+"\r\n",c.localDescription.sdp=k.join("");var l=c._pendingOffer?c._pendingOffer:c.transceivers,m=l.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});switch(c.iceGatheringState){case"new":j||c._localIceCandidatesBuffer.push(h),j&&m&&c._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":c._emitBufferedCandidates(),j||(c.dispatchEvent(h),null!==c.onicecandidate&&c.onicecandidate(h)),m&&(c.dispatchEvent(new Event("icecandidate")),null!==c.onicecandidate&&c.onicecandidate(new Event("icecandidate")),c.iceGatheringState="complete",c._emitGatheringStateChange());break;case"complete":}},e.onicestatechange=function(){c._updateConnectionState()};var g=new RTCDtlsTransport(e);return g.ondtlsstatechange=function(){c._updateConnectionState()},g.onerror=function(){g.state="failed",c._updateConnectionState()},{iceGatherer:d,iceTransport:e,dtlsTransport:g}},b.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);var c=this.transceivers[a].iceTransport;c&&(delete c.onicestatechange,delete this.transceivers[a].iceTransport);var d=this.transceivers[a].dtlsTransport;d&&(delete d.ondtlssttatechange,delete d.onerror,delete this.transceivers[a].dtlsTransport)},b.prototype._transceive=function(b,c,d){var e=this._getCommonCapabilities(b.localCapabilities,b.remoteCapabilities);c&&b.rtpSender&&(e.encodings=b.sendEncodingParameters,e.rtcp={cname:f.localCName,compound:b.rtcpParameters.compound},b.recvEncodingParameters.length&&(e.rtcp.ssrc=b.recvEncodingParameters[0].ssrc),b.rtpSender.send(e)),d&&b.rtpReceiver&&("video"===b.kind&&b.recvEncodingParameters&&a<15019&&b.recvEncodingParameters.forEach(function(a){delete a.rtx}),e.encodings=b.recvEncodingParameters,e.rtcp={cname:b.rtcpParameters.cname,compound:b.rtcpParameters.compound},b.sendEncodingParameters.length&&(e.rtcp.ssrc=b.sendEncodingParameters[0].ssrc),b.rtpReceiver.receive(e))},b.prototype.setLocalDescription=function(a){var b,c,d=this;if("offer"===a.type)this._pendingOffer&&(b=f.splitSections(a.sdp),c=b.shift(),b.forEach(function(a,b){var c=f.parseRtpParameters(a);d._pendingOffer[b].localCapabilities=c}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===a.type){b=f.splitSections(d.remoteDescription.sdp),c=b.shift();var e=f.matchPrefix(c,"a=ice-lite").length>0;b.forEach(function(a,b){var g=d.transceivers[b],h=g.iceGatherer,i=g.iceTransport,j=g.dtlsTransport,k=g.localCapabilities,l=g.remoteCapabilities,m=f.isRejected(a);if(!m&&!g.isDatachannel){var n=f.getIceParameters(a,c),o=f.getDtlsParameters(a,c);e&&(o.role="server"),d.usingBundle&&0!==b||(i.start(h,n,e?"controlling":"controlled"),j.start(o));var p=d._getCommonCapabilities(k,l);d._transceive(g,p.codecs.length>0,!1)}})}switch(this.localDescription={type:a.type,sdp:a.sdp},a.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"')}var g=arguments.length>1&&"function"==typeof arguments[1];if(g){var h=arguments[1];window.setTimeout(function(){h(),"new"===d.iceGatheringState&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),d._emitBufferedCandidates()},0)}var i=Promise.resolve();return i.then(function(){g||("new"===d.iceGatheringState&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),window.setTimeout(d._emitBufferedCandidates.bind(d),500))}),i},b.prototype.setRemoteDescription=function(b){var c=this,d={},e=[],g=f.splitSections(b.sdp),h=g.shift(),i=f.matchPrefix(h,"a=ice-lite").length>0,j=f.matchPrefix(h,"a=group:BUNDLE ").length>0,k=f.matchPrefix(h,"a=ice-options:")[0];switch(k?this.canTrickleIceCandidates=k.substr(14).split(" ").indexOf("trickle")>=0:this.canTrickleIceCandidates=!1,g.forEach(function(g,k){var l=f.splitLines(g),m=f.getKind(g),n=f.isRejected(g),o=l[0].substr(2).split(" ")[2],p=f.getDirection(g,h),q=f.parseMsid(g),r=f.getMid(g)||f.generateIdentifier();if("application"===m&&"DTLS/SCTP"===o)return void(c.transceivers[k]={mid:r,isDatachannel:!0});var s,t,u,v,w,x,y,z,A,B,C,D,E=f.parseRtpParameters(g);n||(C=f.getIceParameters(g,h),D=f.getDtlsParameters(g,h),D.role="client"),z=f.parseRtpEncodingParameters(g);var F=f.parseRtcpParameters(g),G=f.matchPrefix(g,"a=end-of-candidates",h).length>0,H=f.matchPrefix(g,"a=candidate:").map(function(a){return f.parseCandidate(a)}).filter(function(a){return"1"===a.component});if("offer"!==b.type||n)"answer"!==b.type||n||(j&&k>0&&(c._disposeIceAndDtlsTransports(k),c.transceivers[k].iceGatherer=c.transceivers[0].iceGatherer,c.transceivers[k].iceTransport=c.transceivers[0].iceTransport,c.transceivers[k].dtlsTransport=c.transceivers[0].dtlsTransport,c.transceivers[k].rtpSender&&c.transceivers[k].rtpSender.setTransport(c.transceivers[0].dtlsTransport),c.transceivers[k].rtpReceiver&&c.transceivers[k].rtpReceiver.setTransport(c.transceivers[0].dtlsTransport)),s=c.transceivers[k],t=s.iceGatherer,u=s.iceTransport,v=s.dtlsTransport,w=s.rtpSender,x=s.rtpReceiver,y=s.sendEncodingParameters,A=s.localCapabilities,c.transceivers[k].recvEncodingParameters=z,c.transceivers[k].remoteCapabilities=E,c.transceivers[k].rtcpParameters=F,(i||G)&&H.length&&u.setRemoteCandidates(H),j&&0!==k||(u.start(t,C,"controlling"),
v.start(D)),c._transceive(s,"sendrecv"===p||"recvonly"===p,"sendrecv"===p||"sendonly"===p),!x||"sendrecv"!==p&&"sendonly"!==p?delete s.rtpReceiver:(B=x.track,q?(d[q.stream]||(d[q.stream]=new MediaStream),d[q.stream].addTrack(B),e.push([B,x,d[q.stream]])):(d["default"]||(d["default"]=new MediaStream),d["default"].addTrack(B),e.push([B,x,d["default"]]))));else{var I=j&&k>0?{iceGatherer:c.transceivers[0].iceGatherer,iceTransport:c.transceivers[0].iceTransport,dtlsTransport:c.transceivers[0].dtlsTransport}:c._createIceAndDtlsTransports(r,k);if(!G||j&&0!==k||I.iceTransport.setRemoteCandidates(H),A=RTCRtpReceiver.getCapabilities(m),a<15019&&(A.codecs=A.codecs.filter(function(a){return"rtx"!==a.name})),y=[{ssrc:1001*(2*k+2)}],"sendrecv"!==p&&"sendonly"!==p||(x=new RTCRtpReceiver(I.dtlsTransport,m),B=x.track,q?(d[q.stream]||(d[q.stream]=new MediaStream,Object.defineProperty(d[q.stream],"id",{get:function(){return q.stream}})),Object.defineProperty(B,"id",{get:function(){return q.track}}),d[q.stream].addTrack(B),e.push([B,x,d[q.stream]])):(d["default"]||(d["default"]=new MediaStream),d["default"].addTrack(B),e.push([B,x,d["default"]]))),c.localStreams.length>0&&c.localStreams[0].getTracks().length>=k){var J;"audio"===m?J=c.localStreams[0].getAudioTracks()[0]:"video"===m&&(J=c.localStreams[0].getVideoTracks()[0]),J&&(a>=15019&&"video"===m&&(y[0].rtx={ssrc:1001*(2*k+2)+1}),w=new RTCRtpSender(J,I.dtlsTransport))}c.transceivers[k]={iceGatherer:I.iceGatherer,iceTransport:I.iceTransport,dtlsTransport:I.dtlsTransport,localCapabilities:A,remoteCapabilities:E,rtpSender:w,rtpReceiver:x,kind:m,mid:r,rtcpParameters:F,sendEncodingParameters:y,recvEncodingParameters:z},c._transceive(c.transceivers[k],!1,"sendrecv"===p||"sendonly"===p)}}),this.usingBundle=j,this.remoteDescription={type:b.type,sdp:b.sdp},b.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+b.type+'"')}return Object.keys(d).forEach(function(a){var b=d[a];if(b.getTracks().length){c.remoteStreams.push(b);var f=new Event("addstream");f.stream=b,c.dispatchEvent(f),null!==c.onaddstream&&window.setTimeout(function(){c.onaddstream(f)},0),e.forEach(function(a){var d=a[0],e=a[1];if(b.id===a[2].id){var f=new Event("track");f.track=d,f.receiver=e,f.streams=[b],c.dispatchEvent(f),null!==c.ontrack&&window.setTimeout(function(){c.ontrack(f)},0)}})}}),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},b.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._updateSignalingState("closed")},b.prototype._updateSignalingState=function(a){this.signalingState=a;var b=new Event("signalingstatechange");this.dispatchEvent(b),null!==this.onsignalingstatechange&&this.onsignalingstatechange(b)},b.prototype._maybeFireNegotiationNeeded=function(){var a=new Event("negotiationneeded");this.dispatchEvent(a),null!==this.onnegotiationneeded&&this.onnegotiationneeded(a)},b.prototype._updateConnectionState=function(){var a,b=this,c={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(a){c[a.iceTransport.state]++,c[a.dtlsTransport.state]++}),c.connected+=c.completed,a="new",c.failed>0?a="failed":c.connecting>0||c.checking>0?a="connecting":c.disconnected>0?a="disconnected":c["new"]>0?a="new":(c.connected>0||c.completed>0)&&(a="connected"),a!==b.iceConnectionState){b.iceConnectionState=a;var d=new Event("iceconnectionstatechange");this.dispatchEvent(d),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(d)}},b.prototype.createOffer=function(){var b=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var c;1===arguments.length&&"function"!=typeof arguments[0]?c=arguments[0]:3===arguments.length&&(c=arguments[2]);var e=[],g=0,h=0;if(this.localStreams.length&&(g=this.localStreams.reduce(function(a,b){return a+b.getAudioTracks().length},0),h=this.localStreams.reduce(function(a,b){return a+b.getVideoTracks().length},0)),c){if(c.mandatory||c.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==c.offerToReceiveAudio&&(g=c.offerToReceiveAudio===!0?1:c.offerToReceiveAudio===!1?0:c.offerToReceiveAudio),void 0!==c.offerToReceiveVideo&&(h=c.offerToReceiveVideo===!0?1:c.offerToReceiveVideo===!1?0:c.offerToReceiveVideo)}for(this.localStreams.forEach(function(a){a.getTracks().forEach(function(b){e.push({kind:b.kind,track:b,stream:a,wantReceive:"audio"===b.kind?g>0:h>0}),"audio"===b.kind?g--:"video"===b.kind&&h--})});g>0||h>0;)g>0&&(e.push({kind:"audio",wantReceive:!0}),g--),h>0&&(e.push({kind:"video",wantReceive:!0}),h--);e=d(e);var i=f.writeSessionBoilerplate(),j=[];e.forEach(function(c,d){var e=c.track,g=c.kind,h=f.generateIdentifier(),i=b.usingBundle&&d>0?{iceGatherer:j[0].iceGatherer,iceTransport:j[0].iceTransport,dtlsTransport:j[0].dtlsTransport}:b._createIceAndDtlsTransports(h,d),k=RTCRtpSender.getCapabilities(g);a<15019&&(k.codecs=k.codecs.filter(function(a){return"rtx"!==a.name})),k.codecs.forEach(function(a){"H264"===a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1")});var l,m,n=[{ssrc:1001*(2*d+1)}];e&&(a>=15019&&"video"===g&&(n[0].rtx={ssrc:1001*(2*d+1)+1}),l=new RTCRtpSender(e,i.dtlsTransport)),c.wantReceive&&(m=new RTCRtpReceiver(i.dtlsTransport,g)),j[d]={iceGatherer:i.iceGatherer,iceTransport:i.iceTransport,dtlsTransport:i.dtlsTransport,localCapabilities:k,remoteCapabilities:null,rtpSender:l,rtpReceiver:m,kind:g,mid:h,sendEncodingParameters:n,recvEncodingParameters:null}}),"max-compat"!==this._config.bundlePolicy&&(i+="a=group:BUNDLE "+j.map(function(a){return a.mid}).join(" ")+"\r\n"),i+="a=ice-options:trickle\r\n",e.forEach(function(a,b){var c=j[b];i+=f.writeMediaSection(c,c.localCapabilities,"offer",a.stream),i+="a=rtcp-rsize\r\n"}),this._pendingOffer=j;var k=new RTCSessionDescription({type:"offer",sdp:i});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,k),Promise.resolve(k)},b.prototype.createAnswer=function(){var a=this,b=f.writeSessionBoilerplate();this.usingBundle&&(b+="a=group:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(c){if(c.isDatachannel)return void(b+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+c.mid+"\r\n");var d=a._getCommonCapabilities(c.localCapabilities,c.remoteCapabilities),e=d.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length;!e&&c.sendEncodingParameters[0].rtx&&delete c.sendEncodingParameters[0].rtx,b+=f.writeMediaSection(c,d,"answer",a.localStreams[0]),c.rtcpParameters&&c.rtcpParameters.reducedSize&&(b+="a=rtcp-rsize\r\n")});var c=new RTCSessionDescription({type:"answer",sdp:b});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},b.prototype.addIceCandidate=function(a){if(a){var b=a.sdpMLineIndex;if(a.sdpMid)for(var c=0;c<this.transceivers.length;c++)if(this.transceivers[c].mid===a.sdpMid){b=c;break}var d=this.transceivers[b];if(d){var e=Object.keys(a.candidate).length>0?f.parseCandidate(a.candidate):{};if("tcp"===e.protocol&&(0===e.port||9===e.port))return Promise.resolve();if("1"!==e.component)return Promise.resolve();d.iceTransport.addRemoteCandidate(e);var g=f.splitSections(this.remoteDescription.sdp);g[b+1]+=(e.type?a.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=g.join("")}}else for(var h=0;h<this.transceivers.length;h++)if(this.transceivers[h].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},b.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});var b=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],c=function(a){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};return new Promise(function(d){var e=new Map;Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){a[b].type=c(a[b]),e.set(b,a[b])})}),b&&window.setTimeout(b,0,e),d(e)})})},b}},{sdp:1}],8:[function(a,b,c){"use strict";var d=a("../utils").browserDetails,e={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(a,b){if(d.version<38&&a&&a.iceServers){for(var c=[],e=0;e<a.iceServers.length;e++){var f=a.iceServers[e];if(f.hasOwnProperty("urls"))for(var g=0;g<f.urls.length;g++){var h={url:f.urls[g]};0===f.urls[g].indexOf("turn")&&(h.username=f.username,h.credential=f.credential),c.push(h)}else c.push(a.iceServers[e])}a.iceServers=c}return new mozRTCPeerConnection(a,b)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=RTCPeerConnection.prototype[a];RTCPeerConnection.prototype[a]=function(){return arguments[0]=new("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(arguments[0]),b.apply(this,arguments)}});var a=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var b=function(a){var b=new Map;return Object.keys(a).forEach(function(c){b.set(c,a[c]),b[c]=a[c]}),b},c={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(a,f,g){return e.apply(this,[a||null]).then(function(a){if(d.version<48&&(a=b(a)),d.version<53&&!f)try{a.forEach(function(a){a.type=c[a.type]||a.type})}catch(e){if("TypeError"!==e.name)throw e;a.forEach(function(b,d){a.set(d,Object.assign({},b,{type:c[b.type]||b.type}))})}return a}).then(f,g)}}}};b.exports={shimOnTrack:e.shimOnTrack,shimSourceObject:e.shimSourceObject,shimPeerConnection:e.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils":11,"./getusermedia":9}],9:[function(a,b,c){"use strict";var d=a("../utils").log,e=a("../utils").browserDetails;b.exports=function(){var a=function(a){return{name:{NotSupportedError:"TypeError",SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},b=function(b,c,f){var g=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if(void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};"number"==typeof d.ideal?e[c]={min:d.ideal,max:d.ideal}:e[c]=d.ideal,a.advanced.push(e),delete d.ideal,Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return b=JSON.parse(JSON.stringify(b)),e.version<38&&(d("spec: "+JSON.stringify(b)),b.audio&&(b.audio=g(b.audio)),b.video&&(b.video=g(b.video)),d("ff37: "+JSON.stringify(b))),navigator.mozGetUserMedia(b,c,function(b){f(a(b))})},c=function(a){return new Promise(function(c,d){b(a,c,d)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){var b=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];a(b)})},e.version<41){var f=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return f().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a})}}if(e.version<49){var g=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(b){return g(b).then(function(a){if(b.audio&&!a.getAudioTracks().length||b.video&&!a.getVideoTracks().length)throw a.getTracks().forEach(function(a){a.stop()}),new DOMException("The object can not be found here.","NotFoundError");return a},function(b){return Promise.reject(a(b))})}}navigator.getUserMedia=function(a,c,d){return e.version<44?b(a,c,d):(console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),void navigator.mediaDevices.getUserMedia(a).then(c,d))}}},{"../utils":11}],10:[function(a,b,c){"use strict";var d={shimOnAddStream:function(){"object"!=typeof window||!window.RTCPeerConnection||"onaddstream"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(a){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=a),this.addEventListener("track",this._onaddstreampoly=function(a){var b=a.streams[0];if(this._streams||(this._streams=[]),!(this._streams.indexOf(b)>=0)){this._streams.push(b);var c=new Event("addstream");c.stream=a.streams[0],this.dispatchEvent(c)}}.bind(this))}})},shimGetUserMedia:function(){navigator.getUserMedia||(navigator.webkitGetUserMedia?navigator.getUserMedia=navigator.webkitGetUserMedia.bind(navigator):navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(a,b,c){navigator.mediaDevices.getUserMedia(a).then(b,c)}.bind(navigator)))}};b.exports={shimOnAddStream:d.shimOnAddStream,shimGetUserMedia:d.shimGetUserMedia}},{}],11:[function(a,b,c){"use strict";var d=!0,e={disableLog:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(d=a,a?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(d)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(a,b,c){var d=a.match(b);return d&&d.length>=c&&parseInt(d[c],10)},detectBrowser:function(){var a={};if(a.browser=null,a.version=null,"undefined"==typeof window||!window.navigator)return a.browser="Not a browser.",a;if(navigator.mozGetUserMedia)a.browser="firefox",a.version=this.extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)a.browser="chrome",a.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return a.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",a;a.browser="safari",a.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))a.browser="edge",a.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!navigator.mediaDevices||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return a.browser="Not a supported browser.",a;a.browser="safari",a.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}return a},shimCreateObjectURL:function(){if("object"==typeof window&&window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){var a=URL.createObjectURL.bind(URL),b=URL.revokeObjectURL.bind(URL),c=new Map,d=0;URL.createObjectURL=function(b){if("getTracks"in b){var e="polyblob:"+ ++d;return c.set(e,b),console.log("URL.createObjectURL(stream) is deprecated! Use elem.srcObject = stream instead!"),e}return a(b)},URL.revokeObjectURL=function(a){b(a),c["delete"](a)};var e=Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,"src");Object.defineProperty(window.HTMLMediaElement.prototype,"src",{get:function(){return e.get.apply(this)},set:function(a){return this.srcObject=c.get(a)||null,e.set.apply(this,[a])}});var f=HTMLMediaElement.prototype.setAttribute;HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=c.get(arguments[1])||null),f.apply(this,arguments)}}}};b.exports={log:e.log,disableLog:e.disableLog,browserDetails:e.detectBrowser(),extractVersion:e.extractVersion,shimCreateObjectURL:e.shimCreateObjectURL,detectBrowser:e.detectBrowser.bind(e)}},{}]},{},[2])(2)});