define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/drawingboard"],function(a,b,c,d,e){"use strict";return b.debug("Filter PoodLL: drawingboard.js initialising"),{instanceprops:[],loaddrawingboard:function(b){var c="#amdopts_"+b.recorderid,f=a(c).get(0);if(f){if(b=JSON.parse(f.value),b.bgimage)var g="transparent";else{var g="background";b.bgimage="#FFF"}this.config=b,a(c).remove()}var h="#"+b.recorderid+"drawing-board-id",i=new e.Board(b.recorderid+"_drawing-board-id",{recorderid:b.recorderid,size:3,background:b.bgimage,controls:["Color",{Size:{type:"auto"}},{DrawingMode:{filler:!1,eraser:!0,pencil:!0}},"Navigation"],droppable:!0,webStorage:!1,enlargeYourContainer:!0,eraserColor:g});b.db=i;var j=b.vectordata;j&&0!=j.indexOf('{"shapes"')&&0!=j.indexOf('{"colors"')&&(i.history=Y.JSON.parse(j),i.setImg(i.history.values[i.history.position-1])),b.uploader=d.clone(),b.uploader.init(h,b),this.instanceprops[b.recorderid]=b,this.registerEvents(b.recorderid)},registerEvents:function(b){var d=this.instanceprops[b];d.autosave?(d.db.ev.bind("board:startDrawing",function(){var a=document.getElementById(b+"_messages");if(a){a.innerHTML="File has not been saved.";var e=document.getElementById(b+"_btn_upload_whiteboard");e.disabled=!1;var f=c.timeouthandles[b];f&&clearTimeout(f),c.timeouthandles[b]=setTimeout(function(){c.WhiteboardUploadHandler(b,d.db,d,d.uploader)},d.autosave)}}),d.db.ev.bind("board:stopDrawing",function(){var a=document.getElementById(b+"_messages");if(a){var e=c.timeouthandles[b];e&&clearTimeout(e),c.timeouthandles[b]=setTimeout(function(){c.WhiteboardUploadHandler(b,d.db,d,d.uploader)},d.autosave)}})):d.db.ev.bind("board:stopDrawing",function(){var a=document.getElementById(b+"_messages");a&&(a.innerHTML="File has not been saved.")});var e="#"+b+"_btn_upload_whiteboard",f=a(e);f&&(d.autosave?f.click(function(){c.WhiteboardUploadHandler(b,d.db,d,d.uploader)}):f.click(function(){var a=c.getCvs(b,d.db,d);c.pokeVectorData(b,d.db,d),d.uploader.uploadFile(a.toDataURL(),"image")}))}}});